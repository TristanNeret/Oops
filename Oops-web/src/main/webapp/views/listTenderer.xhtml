<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:o="http://omnifaces.org/ui">

    <h:head>
        <title>Tenderer list</title>
        <h:outputStylesheet library="css" name="style.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <script type="text/javascript">
            function handleAskReviewRequest(xhr, status, args) {
                PF('askReviewDialog').hide();
            }
        </script>

    </h:head>

    <h:body>


        <!-- HEADER -->
        <ui:include src="/includes/header.xhtml" />

        <!-- SEARCH -->
        <ui:include src="/includes/search.xhtml" />

        <div style="width : 50%; margin : auto; ">
            <h:outputText id="noResultOutputText" value="Aucun résultat ne correspond aux critères de recherche !" 
                          rendered="#{empty searchManagedBean.ltd}" />
        </div>

        <!-- CONTENT -->
        <div class="divContent">

            <p:growl widgetVar="askReviewGrowl" sticky="false" showDetail="true" life="3000" />

            <o:form id="askReviewForm" includeViewParams="true">
                <c:forEach items="#{searchManagedBean.ltd}" var="tend" rendered="#{not empty searchManagedBean.ltd}">
                    <div class="divContentPadding">
                        <fieldset style="margin-top: 10px;">
                            <h:outputText style="font-size: x-large; padding-right: 20px" value="#{tend.login}" />
                            (<h:outputText value="#{tend.firstname}" style="padding-right: 5px"/>
                            <h:outputText value="#{tend.lastname}" />)

                            <h:panelGrid columns="2" style="float: right;">

                                <h:button class="headerCommandButton" value="Voir #{tend.login}" 
                                          outcome="/views/tendererSearch?id=#{tend.id}" />

                                <p:commandButton id="askReviewBtn" class="headerCommandButton" value="Demander un avis" 
                                                 rendered="#{listTendererBean.display(tend.id)}"
                                                 onclick="PF('askReviewDialog').show();"
                                                 actionListener="#{listTendererBean.setTenderer(tend)}"
                                                 update="askReviewDialogForm:dialogPanel" /> 
                            </h:panelGrid>

                        </fieldset>
                    </div>
                </c:forEach>       
            </o:form>

            <!-- DIALOG BOX FOR ASKING REVIEWS  -->
            <o:form id="askReviewDialogForm" includeViewParams="true">

                <p:dialog header="Demande d'avis" modal="true" widgetVar="askReviewDialog" resizable="false">
                    <p:outputPanel id="dialogPanel">
                        <h:panelGrid columns="1" cellpadding="5">

                            <h:outputLabel id="Infos" value="Soumissionaire : #{listTendererBean.tenderer.login} 
                                           (#{listTendererBean.tenderer.firstname} 
                                           #{listTendererBean.tenderer.lastname})" />

                            <h:outputLabel value="Message :" />
                            <p:inputTextarea id="askReviewMsg" value="#{listTendererBean.message}" 
                                             rows="6" cols="33" placeholder="Facultatif" />

                        </h:panelGrid>
                        <div class="dialogFooter" >
                            <p:commandButton id="sendAskReviewBtn" update="askReviewForm"
                                             value="Envoyer" actionListener="#{listTendererBean.askReview()}"                                                          
                                             oncomplete="handleAskReviewRequest(xhr, status, args)" 
                                             onclick="PF('askReviewGrowl').renderMessage({summary: 'Demande d\'avis envoyée !',
                                                         detail: 'La demande d\'avis à été envoyée', severity: 'info'});" /> 
                        </div>

                    </p:outputPanel>
                </p:dialog>

            </o:form>

        </div>

    </h:body>

    <!-- FOOTER -->
    <ui:include src="/includes/footer.xhtml" />

</html>
