<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <script type="text/javascript">

        function handleContractorStep1Request(xhr, status, args) {
            if (args.validationFailed) {
            } else {

                PF('registerGrowl').renderMessage({summary: 'Inscription réussie !',
                    detail: 'Bienvenue sur Oops !', severity: 'info'});
                PF('registerGrowl').renderMessage({summary: 'Complétez votre inscription !',
                    detail: 'Veuillez complétez votre inscription !', severity: 'info'});

            }
        }
        function handleReviewRequest(xhr, status, args) {
            if (args.validationFailed) {
                PF('prestationDialog').show();
            } else {
                PF('prestationDialog').hide();
            }
        }
        function handleContractorStep4Request(xhr, status, args) {
            if (args.validationFailed) {
            } else {
                PF('registerGrowl').renderMessage({summary: 'Inscription finalisée !',
                    detail: 'Toutes les informations nécessaires ont été fournies !',
                    severity: 'info'});
                // GO HOME
                setTimeout(function () {
                    window.location.href = "/Oops-web";
                }, 3000);
            }
        }
    </script>

    <h:head>
        <title>Oops</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <h:outputStylesheet library="css" name="style.css" />

    </h:head>

    <h:body>

        <!-- HEADER -->
        <ui:include src="/includes/header.xhtml" />

        <!-- SEARCH -->
        <ui:include src="/includes/search.xhtml" />

        <!-- CONTENT -->
        <div class="divContent">

            <p:growl widgetVar="registerGrowl" sticky="false" showDetail="false" life="3000" />

            <!-- STEP 1 -->

            <o:form id="registerContractorForm1" includeViewParams="true">

                <p:fieldset rendered="#{contractorRegistrationBean.step == 1}">

                    <h2>Prestataire, enregistrez-vous et donnez à vos prestations<br/> une dimension Internationale !</h2>

                    <h:panelGrid id="grid1" columns="3" cellpadding="5">

                        <h:outputLabel value="Login :" class="labelModificationForm"/>
                        <p:inputText id="contractorLogin" value="#{contractorRegistrationBean.login}">
                            <f:validator validatorId="com.gdf.loginAlreadyExistValidator" />
                        </p:inputText>
                        <p:message id="contractorLoginMessage" for="contractorLogin" />

                        <h:outputLabel value="Mot de passe :" class="labelModificationForm"/>
                        <p:password id="contractorPassword" value="#{contractorRegistrationBean.password}" 
                                    match="contractorConfirmPassword" feedback="true">
                        </p:password>
                        <p:message id="contractorPasswordMessage" for="contractorPassword" />

                        <h:outputLabel value="Confirmer le mot de passe :" class="labelModificationForm"/>
                        <p:password id="contractorConfirmPassword" value="#{contractorRegistrationBean.passwordConfirm}" 
                                    feedback="true">
                        </p:password>
                        <p:message id="contractorConfirmPasswordMessage" for="contractorConfirmPassword" />

                        <h:outputLabel value="Prénom :" class="labelModificationForm"/>
                        <p:inputText id="contractorFirstname" value="#{contractorRegistrationBean.firstname}">
                        </p:inputText>
                        <p:message id="contractorFirstnameMessage" for="contractorFirstname" />

                        <h:outputLabel value="Nom :" class="labelModificationForm"/>
                        <p:inputText id="contractorLastname" value="#{contractorRegistrationBean.lastname}">
                        </p:inputText>
                        <p:message id="contractorLastnameMessage" for="contractorLastname" />

                        <h:outputLabel value="Adresse mail :" class="labelModificationForm"/>
                        <p:inputText id="contractorMail" value="#{contractorRegistrationBean.email}" >
                            <f:validator validatorId="com.gdf.mailFormatValidator"/>
                        </p:inputText>
                        <p:message id="contractorMailMessage" for="contractorMail" />

                        <h:outputLabel value="Téléphone :" class="labelModificationForm"/>
                        <p:inputText id="contractorPhoneNumber" value="#{contractorRegistrationBean.phone}">
                            <f:validator validatorId="com.gdf.phoneFormatValidator"/>
                        </p:inputText>
                        <p:message id="contractorPhoneNumberMessage" for="contractorPhoneNumber" />

                        <p:commandButton id="contractorNext1Button"
                                         value="Suivant"  update="registerContractorForm1 registerContractorForm2 progressionForm"                                     
                                         action="#{contractorRegistrationBean.step1()}"
                                         oncomplete="handleContractorStep1Request(xhr, status, args)"/>
                    </h:panelGrid>
                </p:fieldset>
            </o:form>


            <!-- STEP 2 -->


            <o:form id="progressionForm">
                <p:fieldset rendered="#{contractorRegistrationBean.step gt 1 and contractorRegistrationBean.step lt 6}">
                    <p:progressBar value="#{(contractorRegistrationBean.step-1)*25}" 
                                   labelTemplate="{value}%" displayOnly="true"/>
                </p:fieldset>
            </o:form>


            <o:form id="registerContractorForm2" includeViewParams="true">
                <p:fieldset rendered="#{contractorRegistrationBean.step == 2}">
                    <h:panelGrid id="grid2" columns="1" cellpadding="5">

                        <h:panelGrid columns="1" cellpadding="0">

                            <h:panelGrid columns="3">

                                <h:outputLabel value="Raison sociale :" class="labelModificationForm"/>
                                <p:inputText id="contractorSocialReason" value="#{contractorRegistrationBean.socialReason}">
                                    <f:validator validatorId="com.gdf.socialReasonValidator"/>
                                </p:inputText>
                                <p:message id="contractorSocialReasonMessage" for="contractorSocialReason" />

                            </h:panelGrid>

                            <h:panelGrid id ="gridSOM" columns="2">

                                <h:outputLabel value="Forme juridique :" class="labelModificationForm"/>                          
                                <p:selectOneMenu id="contractorLegalForm" value="#{contractorRegistrationBean.legalForm}" >
                                    <f:selectItems value="#{contractorRegistrationBean.legalForms}" />
                                    <p:ajax update="gridSOM"/>
                                </p:selectOneMenu>

                                <h:outputLabel value="Nombre d'employés :" 
                                               rendered="#{contractorRegistrationBean.isATeamCompanySelected()}"
                                               class="labelModificationForm"/>
                                <p:selectOneMenu id="contractorNbEmployees" value="#{contractorRegistrationBean.nbEmployees}"
                                                 rendered="#{contractorRegistrationBean.isATeamCompanySelected()}">
                                    <f:selectItem itemLabel="> 1" itemValue="1" />
                                    <f:selectItem itemLabel="> 5" itemValue="5" />
                                    <f:selectItem itemLabel="> 10" itemValue="10" />
                                    <f:selectItem itemLabel="> 50" itemValue="50" />
                                    <f:selectItem itemLabel="> 100" itemValue="100" />
                                    <f:selectItem itemLabel="> 500" itemValue="500" />
                                    <f:selectItem itemLabel="> 1K" itemValue="1000" />
                                    <f:selectItem itemLabel="> 5K" itemValue="5000" />
                                </p:selectOneMenu>

                                <h:outputLabel value="Chiffre d'affaire :" class="labelModificationForm"/>
                                <p:selectOneMenu id="contractorTurnover" value="#{contractorRegistrationBean.turnover}">
                                    <f:selectItem itemLabel="> 500 €" itemValue="500" />
                                    <f:selectItem itemLabel="> 1K €" itemValue="1000" />
                                    <f:selectItem itemLabel="> 5K €" itemValue="5000" />
                                    <f:selectItem itemLabel="> 10K €" itemValue="10000" />
                                    <f:selectItem itemLabel="> 50K €" itemValue="50000" />
                                    <f:selectItem itemLabel="> 100K €" itemValue="100000" />
                                    <f:selectItem itemLabel="> 500K €" itemValue="500000" />
                                    <f:selectItem itemLabel="> 1M €" itemValue="1000000" />
                                </p:selectOneMenu>

                            </h:panelGrid>

                            <h:panelGrid columns="3">
                                <h:outputLabel for="contractorSiren" value="N° SIREN :" class="labelModificationForm"/>
                                <p:inputText  id="contractorSiren"  value="#{contractorRegistrationBean.siren}" size="9" 
                                              maxlength="9">
                                    <f:validator validatorId="com.gdf.sirenValidator"/>
                                </p:inputText>
                                <p:message id="sirenMessage" for="contractorSiren" />

                                <h:outputLabel for="contractorSiret" value="N° SIRET :" class="labelModificationForm"/>
                                <p:inputText  id="contractorSiret"  value="#{contractorRegistrationBean.siret}" size="14" 
                                              maxlength="14">
                                    <f:validator validatorId="com.gdf.siretValidator"/>      
                                </p:inputText>
                                <p:message id="siretMessage" for="contractorSiret" />

                                <h:outputLabel for="contractorRcs" value="N° RCS :" class="labelModificationForm"/>
                                <p:inputText  id="contractorRcs"  value="#{contractorRegistrationBean.rcs}"
                                              maxlength="20">                                 
                                </p:inputText>
                                <p:message id="rcsMessage" for="contractorRcs" />

                                <h:outputLabel for="contractorInsurrance" value="Assurance :" class="labelModificationForm"/>
                                <p:inputText  id="contractorInsurrance"  value="#{contractorRegistrationBean.insurrance}">
                                </p:inputText>
                                <p:message id="insurranceMessage" for="contractorInsurrance" />

                            </h:panelGrid>

                        </h:panelGrid>

                        <!-- -->

                        <h:panelGrid columns="3" cellpadding="5">

                            <h:outputLabel for="contractorStreetNumber" value="N° :" class="labelModificationForm"/>
                            <p:inputText id="contractorStreetNumber" placeholder="Numéro de la rue" value="#{contractorRegistrationBean.streetNumber}">
                            </p:inputText>
                            <p:message id="streetNumberMessage" for="contractorStreetNumber" />

                            <h:outputLabel for="contractorStreet" value="Rue :" class="labelModificationForm"/>
                            <p:inputText id="contractorStreet" value="#{contractorRegistrationBean.street}">
                            </p:inputText>
                            <p:message id="streetMessage" for="contractorStreet" />

                            <h:outputLabel for="contractorZipCode" value="Code postal :" class="labelModificationForm"/>
                            <p:inputText id="contractorZipCode" value="#{contractorRegistrationBean.zipCode}">
                            </p:inputText>
                            <p:message id="zipCodeMessage" for="contractorZipCode" />

                            <h:outputLabel for="contractorTown" value="Ville :" class="labelModificationForm"/>
                            <p:inputText id="contractorTown" value="#{contractorRegistrationBean.town}">
                            </p:inputText>
                            <p:message id="townMessage" for="contractorTown" />
               
                            <h:outputLabel for="contractorCountry" value="Pays :" class="labelModificationForm"/>
                            <p:inputText id="contractorCountry" value="#{contractorRegistrationBean.country}">
                            </p:inputText>
                            <p:message id="countryMessage" for="contractorCountry" />

                        </h:panelGrid>

                    </h:panelGrid>

                    <p:commandButton id="contractorNext2Button"
                                     value="Suivant" update="registerContractorForm2 registerContractorForm3 progressionForm" 
                                     action="#{contractorRegistrationBean.step2()}"/>
                </p:fieldset>

            </o:form>

            <!-- STEP 3 -->

            <o:form id="registerContractorForm3" includeViewParams="true">

                <p:fieldset rendered="#{contractorRegistrationBean.step == 3}">
                    <h:panelGrid id="grid3" columns="3" cellpadding="5">

                        <h:outputLabel for="contractorLogo" value="URL du logo :" class="labelModificationForm"/>
                        <p:inputText id="contractorLogo" placeholder="Facultatif" value="#{contractorRegistrationBean.logo}">
                            <f:validator validatorId="com.gdf.urlLogoValidator"/>
                        </p:inputText>
                        <p:message id="logoMessage" for="contractorLogo" />

                        <h:outputLabel for="contractorDescription" value="Description :" class="labelModificationForm"/>
                        <p:inputTextarea id="contractorDescription"  value="#{contractorRegistrationBean.description}"
                                         rows="7" cols="70" placeholder="Decrivez en quelques mots votre entreprise">
                        </p:inputTextarea>
                        <p:message id="descriptionMessage" for="contractorDescription" />

                        <p:commandButton id="contractorNext3Button"
                                         value="Suivant" update="registerContractorForm3 registerContractorForm4 progressionForm" 
                                         action="#{contractorRegistrationBean.step3()}"/>

                    </h:panelGrid>
                </p:fieldset>

            </o:form>

            <!-- STEP 4 -->

            <o:form id="registerContractorForm4" includeViewParams="true">

                <p:fieldset rendered="#{contractorRegistrationBean.step == 4 or contractorRegistrationBean.step == 5}">
                    <h:outputLabel styleClass="titlePanelReviewAdmin" value="Liste de vos services :" />

                    <p:panel id="grid4">

                        <!-- CONTRACTOR'S SERVICES -->  
                        <p:growl id="growlServiceContractorList" sticky="false" showDetail="false" life="3000" />
                        <div class="divCurrentContractorServices">
                            <h:outputLabel value="Il n'y a encore aucun service vous concernant." rendered="#{!contractorRegistrationBean.areServices()}" /> 
                            <c:forEach items="#{contractorRegistrationBean.contractor.services}" var="service" > 
                                <div class="divLeftContractorService">
                                    <div class="divServiceTitle">
                                        <h:outputText value="#{service.title}" />
                                    </div>
                                    <h:outputText value="#{service.description}"/> 
                                    <div class="divServiceButton">
                                        <div class="leftServiceButton">
                                            Tarif horraire : <b><h:outputText value="#{service.price}"/> €</b> - 
                                            <span class="spanServiceCategory">#{service.category.name}</span>
                                        </div>
                                        <div class="rightServiceButton">  

                                            <!-- Dialog view to edit Prestation -->
                                            <p:dialog id="prestationDialog" header="Modifier votre prestation :" modal="true" resizable="false" widgetVar="prestationDialog" dynamic="true">
                                                <h:panelGrid columns="2" cellpadding="5">
                                                    <h:outputLabel value="Titre :" />
                                                    <p:inputText id="serviceTitle" value="#{contractorRegistrationBean.editService.title}" 
                                                                 style="width: 100%;" required="true" label="Titre de la prestation" />

                                                    <h:outputLabel value="Description :" />
                                                    <p:inputTextarea id="serviceDescription" rows="6" cols="33" style="width: 100%;" 
                                                                     value="#{contractorRegistrationBean.editService.description}" required="true" label="Description" />

                                                    <h:outputLabel value="Catégorie :" />
                                                    <h:outputLabel value="#{contractorRegistrationBean.editService.category.name}" />

                                                    <h:outputLabel value="Tarif :" />
                                                    <p:inputText id="servicePrice" 
                                                                 value="#{contractorRegistrationBean.editService.price}" 
                                                                 style="width: 100%;" label="Tarif" />

                                                    <f:facet name="footer">
                                                        <p:commandButton id="editButtonDialogValidate" value="Modifier" 
                                                                         action="#{contractorRegistrationBean.updateService()}" 
                                                                         oncomplete="handleReviewRequest(xhr, status, args);"
                                                                         update="@form" />
                                                        <p:commandButton id="cancelButtonDialogValidate" value="Annuler" 
                                                                         oncomplete="PF('prestationDialog').hide();" />
                                                    </f:facet>  
                                                </h:panelGrid>
                                            </p:dialog>

                                            <p:commandButton id="updateCommandButton" value="Modifier" 
                                                             action="#{contractorRegistrationBean.setEditService(service)}" 
                                                             styleClass="updateButtonService" update="prestationDialog"
                                                             oncomplete="PF('prestationDialog').show();"/>
                                            <p:commandButton id="deleteCommandButton" value="Supprimer" 
                                                             action="#{contractorRegistrationBean.deleteService(service)}" 
                                                             styleClass="removeButtonService" update="growlServiceContractorList @form progressionForm">
                                                <p:confirm header="Confirmation" 
                                                           message="Êtes-vous sûr de vouloir supprimer cette prestation ?" 
                                                           icon="ui-icon-alert" />
                                            </p:commandButton>

                                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                                <p:commandButton id="confirmButtonDialogValidate" value="Yes" 
                                                                 type="button" styleClass="ui-confirmdialog-yes" 
                                                                 icon="ui-icon-check" />
                                                <p:commandButton id="confirmButtonDialogUnvalidate" value="No" 
                                                                 type="button" styleClass="ui-confirmdialog-no" 
                                                                 icon="ui-icon-close" />
                                            </p:confirmDialog>
                                        </div>
                                    </div>
                                </div>      
                            </c:forEach> 
                        </div>

                        <!-- CONTRACTOR'S NEW SERVICE -->

                        <p:growl id="growlNewServiceContractor" sticky="false" showDetail="false" life="3000" />
                        <div class="divContractorAddService">
                            <div id="divAddServiceTitle">
                                <h:outputLabel value="Ajouter un service :" />
                            </div>
                            <div>
                                <h:inputText id="titleService" styleClass="inputNewContractorService" 
                                             required="true" size="20" value="#{contractorRegistrationBean.titleService}" 
                                             label="Nom de la prestation"/> 
                                <p:watermark for="titleService" value="Nom de la prestation" id="wTitleService" /><br/>
                                <p:inputTextarea id="serviceContent" styleClass="inputNewContractorService" 
                                                 rows="6" cols="50" value="#{contractorRegistrationBean.descriptionService}" 
                                                 required="true" autoResize="false" label="Description" />
                                <p:watermark for="serviceContent" value="Description ..." id="wServiceContent" /><br/>
                                <div class="inputNewContractorService">

                                    <p:selectOneMenu id="selectOneMenuCategorie" 
                                                     value="#{contractorRegistrationBean.idCategoryService}" 
                                                     style="width: 60%;">

                                        <f:selectItems value="#{contractorRegistrationBean.categories}" 
                                                       var="categoryItem" itemLabel="#{categoryItem.name}" 
                                                       itemValue="#{categoryItem.id}" />
                                    </p:selectOneMenu>
                                </div>
                                Tarif : <h:inputText id="priceService" size="10" 
                                                     value="#{contractorRegistrationBean.priceService}" 
                                                     label="Tarif" /> €<br/>
                                <p:watermark for="priceService" value="Tarif en €" id="wPriceService" /><br/>
                                <div class="divContractorService">
                                    <p:commandButton id="addServiceButton" action="#{contractorRegistrationBean.addService()}" 
                                                     value="Ajouter" update="registerContractorForm4 progressionForm" /> 
                                </div>

                                <p:commandButton id="contractorFinishButton" update="registerContractorForm4"
                                                 value="Terminer l'inscription"
                                                 oncomplete="handleContractorStep4Request(xhr, status, args)"
                                                 rendered="#{contractorRegistrationBean.areServices()}"
                                                 action="#{contractorRegistrationBean.setStep(6)}"/>
                            </div>          
                        </div>    

                    </p:panel>

                </p:fieldset>

                <p:fieldset rendered="#{contractorRegistrationBean.step == 6}">
                    <div style="width: 100%; text-align: center; height: 200px; padding-top: 100px; padding-bottom: 100px;">
                        Redirection en cours...
                    </div>
                </p:fieldset>

            </o:form>    

        </div>

        <!-- FOOTER -->
        <ui:include src="/includes/footer.xhtml"/>

    </h:body> 

</html>