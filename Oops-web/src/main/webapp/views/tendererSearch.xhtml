<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:o="http://omnifaces.org/ui">

    <h:head>
        <title>Soumissionnaires</title>
        <h:outputStylesheet library="css" name="style.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <script type="text/javascript">
            function handleAskReviewRequest(xhr, status, args) {
                PF('askReviewDialog').hide();
            }
        </script>

    </h:head>

    <h:body>


        <!-- HEADER -->
        <ui:include src="/includes/header.xhtml" />

        <!-- SEARCH -->
        <ui:include src="/includes/search.xhtml" />

        <p:fieldset rendered="#{empty searchManagedBean.ltd}">
            <div style="width: 100%; text-align: center; height: 200px; padding-top: 100px; padding-bottom: 100px;">
                <h:outputText id="noResultOutputText" value="Aucun résultat ne correspond aux critères de recherche !"/>
            </div>
        </p:fieldset>

        <!-- CONTENT -->
        <div class="divContent">

            <p:growl widgetVar="askReviewGrowl" sticky="false" showDetail="true" life="3000" />

            <o:form id="askReviewForm" includeViewParams="true">
                <table  width="100%" style="margin: 0px;">
                    <c:forEach items="#{searchManagedBean.ltd}" var="tend" rendered="#{not empty searchManagedBean.ltd}">
                        <tr>
                            <td>

                                <fieldset style="margin-top: 10px;">

                                    <h:graphicImage value="#{tend.avatar}" height="75px" style="float: left;"/>

                                    <h:outputText value="#{tend.login}"
                                                  style="font-size: x-large; padding-left: 20px;" />

                                    <c:if test="#{tend.nbReviews lt 2}">
                                        <h:outputText value="#{tend.nbReviews} avis donné" style="float: right;"/>                                               
                                    </c:if>
                                    <c:if test="#{tend.nbReviews gt 1}">
                                        <h:outputText value="#{tend.nbReviews} avis donnés" style="float: right;"/>                                               
                                    </c:if>

                                    <br/>
                                    <h:outputText value="Nom complet : #{tend.firstname} #{tend.lastname}" 
                                                  style="padding-left: 20px;" />

                                    <div style="float: right;">

                                        <p:commandButton id="askReviewBtn" class="headerCommandButton" value="Demander un avis" 
                                                         rendered="#{tendererSearchBean.display(tend.id)}"
                                                         onclick="PF('askReviewDialog').show();"
                                                         actionListener="#{tendererSearchBean.setTenderer(tend)}"
                                                         update="askReviewDialogForm:dialogPanel" /> 
                                        <h:button class="headerCommandButton" value="Voir #{tend.login}" 
                                                  outcome="/views/tendererInformations?id=#{tend.id}" />

                                    </div>   

                                    <br/>
                                    <h:outputText value="Inscrit le #{tend.registrationDate}" 
                                                  style="padding-left: 20px;" /> 
                                </fieldset>

                            </td>
                        </tr>
                    </c:forEach>
                </table>         
            </o:form>

            <!-- DIALOG BOX FOR ASKING REVIEWS  -->
            <o:form id="askReviewDialogForm" includeViewParams="true">

                <p:dialog header="Demande d'avis" modal="true" widgetVar="askReviewDialog" resizable="false">
                    <p:outputPanel id="dialogPanel">
                        <h:panelGrid columns="1" cellpadding="5">

                            <h:outputText value="Soumissionaire : "/>
                            <h:outputText value="#{tendererSearchBean.tenderer.login} 
                                          (#{tendererSearchBean.tenderer.firstname} #{tendererSearchBean.tenderer.lastname})" />

                            <h:outputLabel value="Message :" />
                            <p:inputTextarea id="askReviewMsg" value="#{tendererSearchBean.message}" 
                                             rows="6" cols="33" placeholder="Facultatif" />

                        </h:panelGrid>
                        <div class="dialogFooter" >
                            <p:commandButton id="sendAskReviewBtn" update="askReviewForm"
                                             value="Envoyer" actionListener="#{tendererSearchBean.askReview()}"                                                          
                                             oncomplete="handleAskReviewRequest(xhr, status, args)" 
                                             onclick="PF('askReviewGrowl').renderMessage({summary: 'Demande d\'avis envoyée !',
                                                         detail: 'La demande d\'avis à été envoyée', severity: 'info'});" /> 
                        </div>

                    </p:outputPanel>
                </p:dialog>

            </o:form>

        </div>

    </h:body>

    <!-- FOOTER -->
    <ui:include src="/includes/footer.xhtml" />

</html>
