<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:o="http://omnifaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <script type="text/javascript">
        function handleRequest(xhr, status, args) {
            if (args.validationFailed) {
                PF('registerDialog').jq.effect("shake", {times: 5}, 100);
            }
            else {
                PF('registerDialog').hide();
                PF('registerGrowl').renderMessage({summary: 'Inscription réussie !',
                    detail: 'Bienvenue sur Oops !', severity: 'info'});
            }
        }

        function handleContractorStep1Request(xhr, status, args) {
            if (args.validationFailed) {
                PF('contractorDialogStep1').jq.effect("shake", {times: 5}, 100);
            } else {
                PF('contractorDialogStep1').hide();
                PF('registerGrowl').renderMessage({summary: 'Inscription réussie !',
                    detail: 'Bienvenue sur Oops !', severity: 'info'});
                PF('contractorDialogStep2').show();
            }
        }
        function handleContractorStep2Request(xhr, status, args) {
            if (args.validationFailed) {
                PF('contractorDialogStep2').jq.effect("shake", {times: 5}, 100);
            }
            else {
                PF('contractorDialogStep2').hide();
                PF('registerGrowl').renderMessage({summary: 'Inscription finalisée  !', detail: 'Toutes les informations nécessaires ont été fournies !', severity: 'info'});
            }
        }
    </script>

    <div id="divHeader">

        <p:growl widgetVar="registerGrowl" sticky="false" showDetail="false" life="3000" />

        <p:panelGrid styleClass="panelHeader" columns="3">
            <h:link styleClass="headerTitle" value="Oops" outcome="/index.xhtml"/>
            <h:link styleClass="headerSubtitle" value="Opinion on providers of services" outcome="/index.xhtml"/>

            <p:panelGrid styleClass="panelHeaderButton" columns="3">
                <h:button class="headerCommandButton" value="Connexion" />
                <o:form id="registerForm" includeViewParams="true">
                    <p:commandButton class="headerCommandButton" value="Inscription" onclick="PF('registerDialog').show();"  type="button">
                        <!-- Reset fields on opening -->
                        <p:ajax update="registerLogin" resetValues="true" />
                        <p:ajax update="registerMDP" resetValues="true" />
                        <p:ajax update="registerConfirmMDP" resetValues="true" />
                        <p:ajax update="registerMail" resetValues="true" />
                        <p:ajax update="registerLastname" resetValues="true" />
                        <p:ajax update="registerFirstname" resetValues="true" />
                        <p:ajax update="registerPhoneNumber" resetValues="true" />
                        <p:ajax update="registerAvatar" resetValues="true" />
                    </p:commandButton>
                    <!-- DIALOG BOX FOR TENDERER REGISTRATION -->                   
                    <p:dialog header="Inscription soumissionnaire" modal="true" widgetVar="registerDialog" resizable="false">
                        <div class="dialogTitle">Inscrivez-vous sur le plus grand annuaire de<br/> prestataires du web !</div>
                        <h:panelGrid columns="2" cellpadding="5">

                            <h:outputLabel value="Login :" />
                            <p:inputText id="registerLogin" value="#{tendererBean.login}" label="Login">
                                <f:ajax event="blur" render="loginMessage"/>
                                <f:validator validatorId="com.gdf.loginAlreadyExistValidator" />
                            </p:inputText>
                            <p:message id="loginMessage" for="registerLogin" />

                            <h:outputLabel value="Mot de passe :" />
                            <p:password id="registerMDP" value="#{tendererBean.password}" match="registerConfirmMDP" feedback="true" label="Mot de passe" />

                            <h:outputLabel value="Confirmer le mot de passe :" />
                            <p:password id="registerConfirmMDP" value="#{tendererBean.passwordConfirm}" feedback="true" label="Confirmation du mot de passe" />

                            <h:outputLabel value="Adresse mail :" />
                            <p:inputText id="registerMail" value="#{tendererBean.email}" label="Mail" >
                                <f:ajax event="blur" render="emailMessage"/>
                                <f:validator validatorId="com.gdf.mailFormatValidator" />
                            </p:inputText>
                            <p:message id="emailMessage" for="registerMail" />

                            <h:outputLabel value="Prénom :" />
                            <p:inputText id="registerFirstname" value="#{tendererBean.firstname}" label="Prénom" >
                                <f:ajax event="blur" render="firstnameMessage"/>
                                <f:validator validatorId="com.gdf.noBlankSpaceValidator" />
                            </p:inputText>
                            <p:message id="firstnameMessage" for="registerFirstname" />

                            <h:outputLabel value="Nom :" />
                            <p:inputText id="registerLastname" value="#{tendererBean.lastname}" label="Nom" >
                                <f:ajax event="blur" render="lastnameMessage"/>
                                <f:validator validatorId="com.gdf.noBlankSpaceValidator" />
                            </p:inputText>
                            <p:message id="lastnameMessage" for="registerLastname" />

                            <h:outputLabel value="Téléphone :" />
                            <p:inputText id="registerPhoneNumber" value="#{tendererBean.phone}">
                                <f:ajax event="blur" render="phoneNumberMessage"/>
                                <f:validator validatorId="com.gdf.phoneFormatValidator"/>
                            </p:inputText>
                            <p:message id="phoneNumberMessage" for="registerPhoneNumber" />

                            <h:outputLabel value="Avatar :" />
                            <p:inputText id="registerAvatar" value="#{tendererBean.avatar}">
                                <f:ajax event="blur" render="avatarMessage"/>
                                <f:validator validatorId="com.gdf.urlLogoValidator"/>
                            </p:inputText>
                            <p:message id="avatarMessage" for="registerAvatar" />

                        </h:panelGrid>
                        <div class="dialogFooter" >
                            <p:commandButton value="S'inscrire"
                                             actionListener="#{tendererBean.submit}" 
                                             oncomplete="handleRequest(xhr, status, args)" />
                        </div>
                    </p:dialog>
                </o:form>

                <o:form id="registerContractorFormStep1" includeViewParams="true">
                    <p:commandButton class="headerCommandButton" value="Prestataire ? Inscrivez-vous ici !" onclick="PF('contractorDialogStep1').show();"  type="button">
                        <!-- Reset fields on opening -->
                        <p:ajax update="contractorLogin" resetValues="true" />
                        <p:ajax update="contractorPassword" resetValues="true" />
                        <p:ajax update="contractorConfirmPassword" resetValues="true" />
                        <p:ajax update="contractorFirstname" resetValues="true" />
                        <p:ajax update="contractorLastname" resetValues="true" />
                        <p:ajax update="contractorEmail" resetValues="true" />
                        <p:ajax update="contractorPhoneNumber" resetValues="true" />
                    </p:commandButton>
                    <!-- DIALOG BOX FOR CONTRACTOR REGISTRATION -->
                    <!-- FIRST STEP -->
                    <p:dialog header="Incription prestataire" modal="true" widgetVar="contractorDialogStep1" resizable="false">
                        <div class="dialogTitle">Enregistrez-vous et donnez à vos prestations<br/> une dimension Internationale !</div>
                        <h:panelGrid id="contractorDialogStep1Panel" columns="2" cellpadding="5" >

                            <h:outputLabel value="Login :" />
                            <p:inputText id="contractorLogin" value="#{contractorRegistrationBean.login}" label="Login" >
                                <f:ajax event="blur" render="contractorLoginMessage"/>
                                <f:validator validatorId="com.gdf.loginAlreadyExistValidator" />
                                <f:validator validatorId="com.gdf.noBlankSpaceValidator" />
                            </p:inputText>
                            <p:message id="contractorLoginMessage" for="contractorLogin" />

                            <h:outputLabel value="Mot de passe :" />
                            <p:password id="contractorPassword" value="#{contractorRegistrationBean.password}" match="contractorConfirmPassword" feedback="true" label="Mot de passe" />

                            <h:outputLabel value="Confirmer le mot de passe :" />
                            <p:password id="contractorConfirmPassword" value="#{contractorRegistrationBean.passwordConfirm}" feedback="true" label="Confirmation du mot de passe" />

                            <h:outputLabel value="Prénom :" />
                            <p:inputText id="contractorFirstname" value="#{contractorRegistrationBean.firstname}" label="Prénom" >
                                <f:ajax event="blur" render="contractorFirstnameMessage"/>
                                <f:validator validatorId="com.gdf.noBlankSpaceValidator"/>
                            </p:inputText>
                            <p:message id="contractorFirstnameMessage" for="contractorFirstname" />

                            <h:outputLabel value="Nom :" />
                            <p:inputText id="contractorLastname" value="#{contractorRegistrationBean.lastname}" label="Nom" >
                                <f:ajax event="blur" render="contractorLastnameMessage"/>
                                <f:validator validatorId="com.gdf.noBlankSpaceValidator" />
                            </p:inputText>
                            <p:message id="contractorLastnameMessage" for="contractorLastname" />

                            <h:outputLabel value="Adresse mail :" />
                            <p:inputText id="contractorEmail" value="#{contractorRegistrationBean.email}" label="Mail" >
                                <f:ajax event="blur" render="contractorEmailMessage"/>
                                <f:validator validatorId="com.gdf.mailFormatValidator"/>
                            </p:inputText>
                            <p:message id="contractorEmailMessage" for="contractorEmail" />

                            <h:outputLabel value="Téléphone :" />
                            <p:inputText id="contractorPhoneNumber" value="#{contractorRegistrationBean.phone}" label="Téléphone">
                                <f:ajax event="blur" render="contractorPhoneNumberMessage"/>
                                <f:validator validatorId="com.gdf.phoneFormatValidator"/>
                            </p:inputText>
                            <p:message id="contractorPhoneNumberMessage" for="contractorPhoneNumber" />

                        </h:panelGrid>

                        <div class="dialogFooter" >
                            <p:commandButton value="Suivant"                                       
                                             actionListener="#{contractorRegistrationBean.step1}"
                                             oncomplete="handleContractorStep1Request(xhr, status, args)">

                                <p:ajax update="registerContractorFormStep2:contractorSocialReason" resetValues="true" />
                                <p:ajax update="registerContractorFormStep2:contractorLegalForm" resetValues="true" />
                                <p:ajax update="registerContractorFormStep2:contractorTurnover" resetValues="true" />
                                <p:ajax update="registerContractorFormStep2:contractorNbEmployees" resetValues="true" />
                                <p:ajax update="registerContractorFormStep2:contractorSiren" resetValues="true" />
                                <p:ajax update="registerContractorFormStep2:contractorSiret" resetValues="true" />
                                <p:ajax update="registerContractorFormStep2:contractorRcs" resetValues="true" />
                                <p:ajax update="registerContractorFormStep2:contractorInsurrance" resetValues="true" />
                                <p:ajax update="registerContractorFormStep2:contractorLogo" resetValues="true" />
                            </p:commandButton>
                        </div>
                    </p:dialog>

                </o:form>
                <o:form id="registerContractorFormStep2" includeViewParams="true">

                    <!-- SECOND STEP -->
                    <p:dialog header="Incription prestataire" modal="true" widgetVar="contractorDialogStep2" resizable="false">
                        <div class="dialogTitle">Enregistrez-vous et donnez à vos prestations<br/> une dimension Internationale !</div>
                        <h:panelGrid id="contractorDialogStep2Panel" columns="2" cellpadding="5" >    

                            <h:outputLabel value="Raison sociale :" />
                            <p:inputText id="contractorSocialReason" value="#{contractorRegistrationBean.socialReason}" label="Raison sociale" >
                                <f:ajax event="blur" render="contractorSocialReason"/>
                                <f:validator validatorId="com.gdf.noBlankSpaceValidator" />
                            </p:inputText>
                            <p:message id="contractorSocialReasonMessage" for="contractorSocialReason" />

                            <h:outputLabel value="Forme juridique :" />                          
                            <p:selectOneMenu id="contractorLegalForm" value="#{contractorRegistrationBean.legalForm}" >
                                <f:selectItems value="#{contractorRegistrationBean.legalForms}" />
                                <p:ajax update="registerContractorFormStep2:contractorDialogStep2Panel"/>
                            </p:selectOneMenu>

                            <h:outputLabel value="Nombre d'employés :" rendered="#{contractorRegistrationBean.isATeamCompanySelected()}"/>
                            <p:selectOneMenu id="contractorNbEmployees" value="#{contractorRegistrationBean.nbEmployees}"
                                             rendered="#{contractorRegistrationBean.isATeamCompanySelected()}">
                                <f:selectItem itemLabel="> 1" itemValue="1" />
                                <f:selectItem itemLabel="> 5" itemValue="5" />
                                <f:selectItem itemLabel="> 10" itemValue="10" />
                                <f:selectItem itemLabel="> 50" itemValue="50" />
                                <f:selectItem itemLabel="> 100" itemValue="100" />
                                <f:selectItem itemLabel="> 500" itemValue="500" />
                                <f:selectItem itemLabel="> 1K" itemValue="1000" />
                                <f:selectItem itemLabel="> 5K" itemValue="5000" />
                            </p:selectOneMenu>

                            <h:outputLabel value="Chiffre d'affaire :" />
                            <p:selectOneMenu id="contractorTurnover" value="#{contractorRegistrationBean.turnover}">
                                <f:selectItem itemLabel="> 500 €" itemValue="500" />
                                <f:selectItem itemLabel="> 1K €" itemValue="1000" />
                                <f:selectItem itemLabel="> 5K €" itemValue="5000" />
                                <f:selectItem itemLabel="> 10K €" itemValue="10000" />
                                <f:selectItem itemLabel="> 50K €" itemValue="50000" />
                                <f:selectItem itemLabel="> 100K €" itemValue="100000" />
                                <f:selectItem itemLabel="> 500K €" itemValue="500000" />
                                <f:selectItem itemLabel="> 1M €" itemValue="1000000" />
                            </p:selectOneMenu>

                            <h:outputLabel for="contractorSiren" value="N° SIREN :" />
                            <p:inputText  id="contractorSiren"  value="#{contractorRegistrationBean.siren}" size="9" 
                                          maxlength="9">
                                <f:ajax event="blur" render="sirenMessage"/>
                                <f:validator validatorId="com.gdf.sirenValidator"/>
                            </p:inputText>
                            <p:message id="sirenMessage" for="contractorSiren" />

                            <h:outputLabel for="contractorSiret" value="N° SIRET :" />
                            <p:inputText  id="contractorSiret"  value="#{contractorRegistrationBean.siret}" size="14" 
                                          maxlength="14">
                                <f:ajax event="blur" render="siretMessage"/>
                                <f:validator validatorId="com.gdf.siretValidator"/>      
                            </p:inputText>
                            <p:message id="siretMessage" for="contractorSiret" />

                            <h:outputLabel for="contractorRcs" value="N° RCS :" />
                            <p:inputText  id="contractorRcs"  value="#{contractorRegistrationBean.rcs}"
                                          maxlength="20">
                                <f:ajax  event="blur" render="rcsMessage"/>
                                <f:validator validatorId="com.gdf.notNullnBSValidator"/>
                            </p:inputText>
                            <p:message id="rcsMessage" for="contractorRcs" />

                            <h:outputLabel for="contractorInsurrance" value="Assurance :" />
                            <p:inputText  id="contractorInsurrance"  value="#{contractorRegistrationBean.insurrance}">
                                <f:ajax  event="blur" render="insurranceMessage"/>
                                <f:validator validatorId="com.gdf.notNullnBSValidator"/>
                            </p:inputText>
                            <p:message id="insurranceMessage" for="contractorInsurrance" />

                            <h:outputLabel for="contractorLogo" value="Logo :" />
                            <p:inputText id="contractorLogo" placeholder="Entrez l'URL du logo" value="#{contractorRegistrationBean.logo}">
                                <f:ajax  event="blur" render="logoMessage"/>
                                <f:validator validatorId="com.gdf.urlLogoValidator"/>
                            </p:inputText>
                            <p:message id="logoMessage" for="contractorLogo" />

                        </h:panelGrid>
                        <div class="dialogFooter" >
                            <p:commandButton value="Suivant"
                                             actionListener="#{contractorRegistrationBean.step2}" 
                                             oncomplete="handleContractorStep2Request(xhr, status, args)" />
                        </div>
                    </p:dialog>

                </o:form>

            </p:panelGrid>
        </p:panelGrid>


    </div>

</ui:composition>
