<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:t="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:o="http://omnifaces.org/ui">

    <script type="text/javascript">
        function handleModifCompanyInfosRequest(xhr, status, args) {
            if (args.validationFailed) {
                PF('modifDialog').jq.effect("shake", {times: 5}, 100);
            }
            else {
                PF('modifDialog').hide();
                PF('modifOKGrowl').renderMessage({summary: 'Modification effectuée !',
                    detail: 'Les informations de votre entreprise ont été mis à jour !',
                    severity: 'info'});
            }
        }
    </script>

    <div class="divContent">

        <o:form id="viewForm" includeViewParams="true">

            <div class="divContractorLogo">
                <h:graphicImage value="#{contractorEditBean.contractor.logo}" height="150px" rendered="#{contractorEditBean.isLogo()}" />
                <h:outputLabel value="Aucune image" rendered="#{!contractorEditBean.isLogo()}" />
            </div>

            <p:panel id="content" class="panelCompanyInformation">
                <table id="table">
                    <tr>
                        <td class="labelTitleContractorInformation">
                            <h:outputLabel value="Raison sociale :"/>
                        </td>
                        <td>
                            <h:outputText id="socialReasonOT" value="#{contractorEditBean.contractor.socialReason}"/>
                        </td>
                    </tr>     

                    <tr>
                        <td class="labelTitleContractorInformation">
                            <h:outputLabel value="Forme juridique :"/>
                        </td>
                        <td>
                            <h:outputText id="legalFormOT" value="#{contractorEditBean.contractor.legalForm}"/>
                        </td>
                    </tr> 

                    <c:if test="#{contractorEditBean.isATeamCompanySelected()}">
                        <tr>
                            <td class="labelTitleContractorInformation">
                                <h:outputLabel value="Nombre d'employés :"/>
                            </td>
                            <td> 
                                <h:outputText id="nbEmployeesOT" value="> #{contractorEditBean.contractor.nbEmployees}"/>  
                            </td>
                        </tr>
                    </c:if>

                    <tr>
                        <td class="labelTitleContractorInformation">
                            <h:outputLabel value="Chiffre d'affaire :"/>
                        </td>
                        <td>
                            <h:outputText id="turnoverOT" value="> #{contractorEditBean.contractor.turnover} €" />
                        </td>
                    </tr>

                    <tr>
                        <td class="labelTitleContractorInformation">
                            <h:outputLabel value="N° SIREN :"/>
                        </td>
                        <td>
                            <h:outputText id="sirenOT" value="#{contractorEditBean.contractor.legalInformation.siren}"/>
                        </td>
                    </tr>

                    <tr>
                        <td class="labelTitleContractorInformation">
                            <h:outputLabel value="N° SIRET :"/>
                        </td>
                        <td>
                            <h:outputText id="siretOT" value="#{contractorEditBean.contractor.legalInformation.siret}"/>
                        </td>
                    </tr>

                    <tr>
                        <td class="labelTitleContractorInformation">
                            <h:outputLabel value="N° RCS :"/>
                        </td>
                        <td>
                            <h:outputText id="rcsOT" value="#{contractorEditBean.contractor.legalInformation.rcs}"/>
                        </td>
                    </tr>

                    <tr>
                        <td class="labelTitleContractorInformation">
                            <h:outputLabel value="Assurance :"/>
                        </td>
                        <td>
                            <h:outputText id="insurranceOT" value="#{contractorEditBean.contractor.legalInformation.insurrance}"/>
                        </td>
                    </tr>                                  
                </table>

                <p:commandButton id="openUpdateDialogButton" value="Modifier" onclick="PF('modifDialog').show();">
                    <p:ajax update="tabViewContractor:dialogForm:socialReasonIT"/>
                    <p:ajax update="tabViewContractor:dialogForm:legalFormSOM"/>
                    <p:ajax update="tabViewContractor:dialogForm:turnoverSOM"/>
                    <p:ajax update="tabViewContractor:dialogForm:nbEmployeesSOM"/> 
                    <p:ajax update="tabViewContractor:dialogForm:sirenIT"/>
                    <p:ajax update="tabViewContractor:dialogForm:siretIT"/>
                    <p:ajax update="tabViewContractor:dialogForm:rcsIT"/>
                    <p:ajax update="tabViewContractor:dialogForm:insurranceIT"/>
                    <p:ajax update="tabViewContractor:dialogForm:logoIT"/>
                    <p:ajax update="tabViewContractor:dialogForm:socialReasonMessage"/>
                    <p:ajax update="tabViewContractor:dialogForm:sirenMessage"/>
                    <p:ajax update="tabViewContractor:dialogForm:siretMessage"/>
                    <p:ajax update="tabViewContractor:dialogForm:rcsMessage"/>
                    <p:ajax update="tabViewContractor:dialogForm:insurranceMessage"/>
                    <p:ajax update="tabViewContractor:dialogForm:logoMessage"/>
                </p:commandButton>
            </p:panel>

        </o:form>

        <p:growl widgetVar="modifOKGrowl" sticky="false" showDetail="true" life="3000" />

        <!-- DIALOG BOX FOR ASKING REVIEWS  -->
        <o:form id="dialogForm" includeViewParams="true">

            <p:dialog header="Modification informations entreprise"  modal="true" widgetVar="modifDialog" resizable="false">

                <h:panelGroup id="dialogPanel">
                    <p>
                        <h:outputLabel for="socialReasonIT" value="Raison sociale :" class="labelModificationForm"/>
                        <p:inputText  id="socialReasonIT"  value="#{contractorEditBean.contractor.socialReason}" >
                            <f:ajax  event="blur" render="socialReasonMessage"/>
                            <f:validator validatorId="com.gdf.socialReasonValidator"/>
                        </p:inputText>
                        <p:message id="socialReasonMessage" for="socialReasonIT" />
                    </p>
                    <p>
                        <h:outputLabel for="legalFormSOM" value="Forme juridique :" class="labelModificationForm"/>
                        <p:selectOneMenu id="legalFormSOM" value="#{contractorEditBean.contractor.legalForm}" >
                            <f:selectItems value="#{contractorEditBean.legalForms}" />
                            <p:ajax update="tabViewContractor:dialogForm:dialogPanel"/>
                        </p:selectOneMenu>
                    </p>
                    <p>
                        <h:outputLabel id="nbEmployeesOL" for="nbEmployeesSOM" value="Nombre d'employés :" 
                                       rendered="#{contractorEditBean.isATeamCompanySelected()}" class="labelModificationForm"/>
                        <p:selectOneMenu id="nbEmployeesSOM" value="#{contractorEditBean.contractor.nbEmployees}"
                                         rendered="#{contractorEditBean.isATeamCompanySelected()}">
                            <f:selectItem itemLabel="> 1" itemValue="1" />
                            <f:selectItem itemLabel="> 5" itemValue="5" />
                            <f:selectItem itemLabel="> 10" itemValue="10" />
                            <f:selectItem itemLabel="> 50" itemValue="50" />
                            <f:selectItem itemLabel="> 100" itemValue="100" />
                            <f:selectItem itemLabel="> 500" itemValue="500" />
                            <f:selectItem itemLabel="> 1K" itemValue="1000" />
                            <f:selectItem itemLabel="> 5K" itemValue="5000" />
                        </p:selectOneMenu>
                    </p>
                    <p>
                        <h:outputLabel for="turnoverSOM" value="Chiffre d'affaire :" class="labelModificationForm"/>
                        <p:selectOneMenu id="turnoverSOM" value="#{contractorEditBean.contractor.turnover}">
                            <f:selectItem itemLabel="> 500 €" itemValue="500" />
                            <f:selectItem itemLabel="> 1K €" itemValue="1000" />
                            <f:selectItem itemLabel="> 5K €" itemValue="5000" />
                            <f:selectItem itemLabel="> 10K €" itemValue="10000" />
                            <f:selectItem itemLabel="> 50K €" itemValue="50000" />
                            <f:selectItem itemLabel="> 100K €" itemValue="100000" />
                            <f:selectItem itemLabel="> 500K €" itemValue="500000" />
                            <f:selectItem itemLabel="> 1M €" itemValue="1000000" />
                        </p:selectOneMenu>
                    </p>
                    <p>
                        <h:outputLabel for="sirenIT" value="N° SIREN : " class="labelModificationForm"/>
                        <p:inputText  id="sirenIT"  value="#{contractorEditBean.contractor.legalInformation.siren}" size="9" 
                                      maxlength="9">
                            <f:ajax  event="blur" render="sirenMessage"/>
                            <f:validator validatorId="com.gdf.sirenValidator"/>
                        </p:inputText>
                        <p:message id="sirenMessage" for="sirenIT" />
                    </p>
                    <p>
                        <h:outputLabel for="siretIT" value="N° SIRET : " class="labelModificationForm"/>
                        <p:inputText  id="siretIT"  value="#{contractorEditBean.contractor.legalInformation.siret}" size="14" 
                                      maxlength="14">
                            <f:ajax  event="blur" render="siretMessage"/>
                            <f:validator validatorId="com.gdf.siretValidator"/>      
                        </p:inputText>
                        <p:message id="siretMessage" for="siretIT" />
                    </p>
                    <p>
                        <h:outputLabel for="rcsIT" value="N° RCS :" class="labelModificationForm"/>
                        <p:inputText  id="rcsIT"  value="#{contractorEditBean.contractor.legalInformation.rcs}"
                                      maxlength="20">
                            <f:ajax  event="blur" render="rcsMessage"/>
                        </p:inputText>
                        <p:message id="rcsMessage" for="rcsIT" />
                    </p>
                    <p>
                        <h:outputLabel for="insurranceIT" value="Assurance :" class="labelModificationForm"/>
                        <p:inputText  id="insurranceIT"  value="#{contractorEditBean.contractor.legalInformation.insurrance}">
                            <f:ajax  event="blur" render="insurranceMessage"/>
                        </p:inputText>
                        <p:message id="insurranceMessage" for="insurranceIT" />
                    </p>
                    <p>
                        <h:outputLabel for="logoIT" value="Logo :" class="labelModificationForm"/>
                        <p:inputText id="logoIT" placeholder="Entrez l'URL du logo" value="#{contractorEditBean.contractor.logo}">
                            <f:ajax  event="blur" render="logoMessage"/>
                            <f:validator validatorId="com.gdf.urlLogoValidator"/>
                        </p:inputText>
                        <p:message id="logoMessage" for="logoIT" />
                    </p>

                    <div class="dialogFooter" >
                        <p:commandButton  id="updateButton" value="Enregistrer" update="tabViewContractor:viewForm"
                                          actionListener="#{contractorEditBean.update()}"
                                          oncomplete="handleModifCompanyInfosRequest(xhr, status, args)" />

                        <p:commandButton  value="Annuler" id="cancelButton" 
                                          onclick="PF('modifDialog').hide();"/>
                    </div>

                </h:panelGroup>
            </p:dialog>
        </o:form>
    </div>

</ui:composition>