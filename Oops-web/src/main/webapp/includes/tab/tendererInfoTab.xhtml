<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:o="http://omnifaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <c:if test="#{tendererInfoMngBean.tenderer == null}" >
        <h1>Vous devez être connecté pour acceder à vos informations</h1>
    </c:if>
    <c:if test="#{tendererInfoMngBean.tenderer != null}" >

        <div class="divContent">
            <o:form id="infoForm" includeViewParams="true">
                
                <p:panel id="content">
                <table id="table">
                    <tr>
                        <td><h:graphicImage value="#{tendererInfoMngBean.tenderer.avatar}"/></td>
                    </tr> 
                    <tr>
                        <td>Login : </td>
                        <td><h:outputText value="#{tendererInfoMngBean.tenderer.login}"/></td>
                    </tr>
                    <tr>
                        <td>Prénom : </td>
                        <td><h:outputText value="#{tendererInfoMngBean.tenderer.firstname}"/></td>
                    </tr>
                    <tr>
                        <td>Nom : </td>
                        <td><h:outputText value="#{tendererInfoMngBean.tenderer.lastname}"/></td>
                    </tr>
                    <tr>
                        <td>E-mail : </td>
                        <td><h:outputText value="#{tendererInfoMngBean.tenderer.email}"/></td>
                    </tr>
                    <tr>
                        <td>Téléphone : </td>
                        <td><h:outputText value="#{tendererInfoMngBean.tenderer.phone}"/></td>
                    </tr>
                    <tr>
                        <td>Inscrit depuis le : </td>
                        <td><h:outputText value="#{tendererInfoMngBean.tenderer.registrationDate}"/></td>

                    </tr>
                </table>
               
                <p:commandButton id="modifier" value="Modifier" update="dialogEditInfo" oncomplete="PF('infoDialog').show();" />
 </p:panel>
                <script type="text/javascript">
                    function handleUpdateRequest(xhr, status, args) {
                        if (args.validationFailed) {
                            PF('infoDialog').jq.effect("shake", {times: 5}, 100);
                        }
                        else {
                            PF('infoDialog').hide();
                            PF('updateGrowl').renderMessage({summary: 'Modifications enregistrés !', severity: 'info'});
                        }
                    }

                </script>

                <!-- Dialog view to edit Review -->
                <p:growl id="updateGrowl" widgetVar="updateGrowl" sticky="false" showDetail="false" life="3000" />
                <p:dialog id="dialogEditInfo" header="Modifier mes informations :" modal="true" widgetVar="infoDialog" dynamic="true" resizable="false">

                    <h:panelGrid columns="2" cellpadding="5">

                        <h:outputLabel value="Avatar :" />
                        <p:inputText id="avatar" value="#{tendererInfoMngBean.tenderer.avatar}" />

                        <h:outputLabel value="Prénom :" />
                        <p:inputText id="firstname" value="#{tendererInfoMngBean.tenderer.firstname}" >
                            <f:validator validatorId="com.gdf.noBlankSpaceValidator" binding="#{noBlankSpaceValidator}" />
                        </p:inputText>

                        <h:outputLabel value="Nom :" />
                        <p:inputText id="lastname" value="#{tendererInfoMngBean.tenderer.lastname}" >
                            <f:validator validatorId="com.gdf.noBlankSpaceValidator" binding="#{noBlankSpaceValidator}" />
                        </p:inputText>

                        <h:outputLabel value="E-mail :" />
                        <p:inputText id="email" value="#{tendererInfoMngBean.tenderer.email}" >
                            <f:validator validatorId="com.gdf.mailFormatValidator" binding="#{mailFormatValidator}" />
                        </p:inputText>

                        <h:outputLabel value="Téléphone :" />
                        <p:inputText id="phone" value="#{tendererInfoMngBean.tenderer.phone}" />

                        <h:outputLabel value="Mot de passe :" />
                        <p:password id="password" value="#{tendererInfoMngBean.password}" match="passconfirm" feedback="true" placeholder="laissez vide pour ne pas modifier" validatorMessage="Les mots de passe ne correspondent pas" />

                        <h:outputLabel value="Confirmez le mot de passe :" />
                        <p:password id="passconfirm" value="#{tendererInfoMngBean.passConfirm}" feedback="true" placeholder="laissez vide pour ne pas modifier"/>

                        <f:facet name="footer">
                            <p:commandButton id="enregistrer" value="Enregistrer" action="#{tendererInfoMngBean.update()}" 
                                             oncomplete="handleUpdateRequest(xhr, status, args)" update="updateGrowl content" />
                            <p:commandButton value="Annuler" oncomplete="PF('infoDialog').hide();" />
                        </f:facet>  

                    </h:panelGrid>

                </p:dialog>
            </o:form>
        </div>

    </c:if>

</ui:composition>