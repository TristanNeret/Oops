<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:oou="http://omnifaces.org/ui"
    xmlns:o="http://omnifaces.org/ui"
    xmlns:b="http://bootsfaces.net/ui">

    <script type="text/javascript">
        function handleMdpModification(xhr, status, args) {
            if (args.validationFailed) {
                PF('mdpDialog').jq.effect("shake", {times: 5}, 100);
            }
            else {
                PF('mdpDialog').hide();
                PF('growlError').renderMessage({summary: 'Succès!', detail: 'Votre mot de passe a été changé !', severity: 'info'});
            }
        }

        function handleModification(xhr, status, args) {
            if (args.validationFailed) {
                PF('modifyDialog').jq.effect("shake", {times: 5}, 100);
            }
            else {
                PF('modifyDialog').hide();
                PF('growlError').renderMessage({summary: 'Succès!', detail: 'Vos informations ont été modifiées !', severity: 'info'});
            }
        }

    </script>

    <div class="container">

        <h:outputLabel styleClass="titlePanelReviewAdmin" value="Informations personnelles du représentant :" /> 

        <o:form id="infoForm" includeViewParams="true">

            <p:growl widgetVar="growlError" sticky="false" showDetail="true" life="3000" />

            <b:container fluid="true" style="margin-top: 20px;">
                <b:row styleClass="show-grid">
                    <b:column span="12" styleClass="columnTendererField">
                        <b:row styleClass="rowTendererField"><b>Login : </b><h:outputText value="#{contractorEditBean.contractor.login}"/></b:row>
                        <b:row styleClass="rowTendererField"><b>Prénom : </b><h:outputText value="#{contractorEditBean.contractor.representatorFirstname}"/></b:row>
                        <b:row styleClass="rowTendererField"><b>Nom : </b><h:outputText value="#{contractorEditBean.contractor.representatorLastname}"/></b:row>
                        <b:row styleClass="rowTendererField"><b>E-mail : </b><h:outputText value="#{contractorEditBean.contractor.email}"/></b:row>
                        <b:row styleClass="rowTendererField"><b>Téléphone : </b><h:outputText value="#{contractorEditBean.contractor.phone}"/></b:row>
                        <b:row styleClass="rowTendererField">

                            <p:commandButton id="buttonModify" class="searchCommandButton" styleClass="buttonBackRegistration" value="Modifier" onclick="PF('modifyDialog').show();">
                                <p:ajax update="tabViewContractor:formModify:modifiedLogin"/>
                                <p:ajax update="tabViewContractor:formModify:modifiedFirstName"/>
                                <p:ajax update="tabViewContractor:formModify:modifiedLastName"/>
                                <p:ajax update="tabViewContractor:formModify:modifiedEmail"/>
                                <p:ajax update="tabViewContractor:formModify:modifiedPhoneNumber"/>
                                <p:ajax update="tabViewContractor:formModify:modifiedEmail"/>
                                <p:ajax update="tabViewContractor:formModify:loginMessage"/>
                                <p:ajax update="tabViewContractor:formModify:phoneMessage"/>
                                <p:ajax update="tabViewContractor:formModify:emailMessage"/>
                                <p:ajax update="tabViewContractor:formModify:lastNameMessage"/>
                                <p:ajax update="tabViewContractor:formModify:firstNameMessage"/>
                            </p:commandButton>

                            <p:commandButton class="searchCommandButton" id="buttonModifyMdp" styleClass="buttonBackRegistration" value="Modifier mon mot de passe" onclick="PF('mdpDialog').show();">
                                <p:ajax update="tabViewContractor:formModifyMdp:confirmationPassword" resetValues="true"/>
                                <p:ajax update="tabViewContractor:formModifyMdp:password" resetValues="true"/>
                            </p:commandButton>
                            
                            <b:button look="link" value="Voir la page de l'entreprise" style="margin-top: 20px;" outcome="/views/contractorInformations.xhtml?id=#{contractorEditBean.contractor.id}" />

                        </b:row>
                    </b:column>
                </b:row>
            </b:container>

        </o:form>

        <!-- Edit Dialog -->
        <o:form id="formModify">

            <p:dialog header="Modification informations personelles :" modal="true" widgetVar="modifyDialog" resizable="false">             

                <h:panelGroup id="infoc">

                    <p>       
                        <h:outputLabel for="modifiedLogin" class="labelModificationForm"> Login: </h:outputLabel>
                        <p:inputText   id="modifiedLogin" value="#{contractorEditBean.contractor.login}">
                            <f:ajax  event="blur" render="loginMessage"/>
                            <f:validator validatorId="com.gdf.loginAlreadyExistForModificationValidator"/>
                        </p:inputText>
                        <p:message id="loginMessage" for="modifiedLogin"/>
                    </p>

                    <p>
                        <h:outputLabel for="modifiedFirstName" class="labelModificationForm"> Prénom: </h:outputLabel>
                        <p:inputText  id="modifiedFirstName" value="#{contractorEditBean.contractor.representatorFirstname}">
                            <f:ajax  event="blur" render="firstNameMessage"/>
                        </p:inputText>
                        <p:message id="firstNameMessage" for="modifiedFirstName"/>
                    </p>

                    <p>
                        <h:outputLabel for="modifiedLastName" class="labelModificationForm"> Nom: </h:outputLabel>
                        <p:inputText  id="modifiedLastName" value="#{contractorEditBean.contractor.representatorLastname}">
                            <f:ajax  event="blur" render="lastNameMessage"/>
                        </p:inputText>
                        <p:message id="lastNameMessage" for="modifiedLastName"/>
                    </p>

                    <p>
                        <h:outputLabel for="modifiedEmail" class="labelModificationForm"> Email : </h:outputLabel>
                        <p:inputText  id="modifiedEmail" value="#{contractorEditBean.contractor.email}">
                            <f:ajax  event="blur" render="emailMessage"/>
                            <f:validator validatorId="com.gdf.mailFormatValidator"/>
                            <f:validator validatorId="com.gdf.emailAlreadyExistForModificationValidator"/>
                        </p:inputText>
                        <p:message id="emailMessage" for="modifiedEmail"/>

                    </p>

                    <p>
                        <h:outputLabel for="modifiedPhoneNumber" class="labelModificationForm"> Phone : </h:outputLabel>
                        <p:inputText  id="modifiedPhoneNumber" value="#{contractorEditBean.contractor.phone}">
                            <f:validator validatorId="com.gdf.phoneFormatValidator"/>
                            <f:ajax  event="blur" render="phoneMessage"/>
                        </p:inputText>
                        <p:message id="phoneMessage" for="modifiedPhoneNumber"/> 
                    </p>

                    <p:commandButton value="Modifier" update="tabViewContractor:infoForm" actionListener="#{contractorEditBean.update()}" 
                                     oncomplete="handleModification(xhr, status, args)" />
                </h:panelGroup>

                <h:form>
                    <p:commandButton class="searchCommandButton"  value="Annuler" actionListener="#{contractorEditBean.undo()}" oncomplete="PF('modifyDialog').hide();"></p:commandButton>  
                </h:form> 

            </p:dialog>

        </o:form>

        <!-- Password Dialog -->
        <o:form id="formModifyMdp">

            <p:growl widgetVar="growlError" sticky="false" showDetail="true" life="3000" />

            <p:dialog header="Modification du Mot de passe:" modal="true" widgetVar="mdpDialog" resizable="false">   
                <p>
                    <h:outputLabel value ="" for="password" class="labelModificationForm" >Mot de passe</h:outputLabel>
                    <h:inputSecret id="password" value="#{contractorEditBean.contractor.password}" size="20" maxlength="20" binding="#{composantMotDePasse}" >
                        <f:ajax event="blur" execute="password confirmationPassword" render="passwordMessage confirmationPasswordMessage" />
                    </h:inputSecret>  
                    <p:message id="passwordMessage" for="password"/>
                </p>

                <p>
                    <h:outputLabel for="confirmationPassword" class="labelModificationForm">Confirmation du mot de passe</h:outputLabel>
                    <h:inputSecret id="confirmationPassword" value="#{contractorEditBean.contractor.password}" size="20" maxlength="20">
                        <f:validator validatorId="com.gdf.passwordConfirmationValidator" />
                        <f:attribute name="composantMotDePasse" value="#{composantMotDePasse}" />
                        <f:ajax event="blur" execute="password confirmationPassword" render="passwordMessage confirmationPasswordMessage" /> 
                    </h:inputSecret> 
                    <p:message id="confirmationPasswordMessage" for="confirmationPassword"/>
                </p>

                <p:commandButton value="Modifier"  actionListener="#{contractorEditBean.update()}" 
                                 oncomplete="handleMdpModification(xhr, status, args)" />
                <p:commandButton value="Annuler" oncomplete="PF('mdpDialog').hide();" />

            </p:dialog>      
        </o:form>

    </div>

</ui:composition>
