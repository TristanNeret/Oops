<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

  
<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:oou="http://omnifaces.org/ui"
    xmlns:o="http://omnifaces.org/ui"
    >

    <script type="text/javascript">
            function handleMdpModification(xhr, status, args) {
                if (args.validationFailed) {
                    PF('mdpDialog').jq.effect("shake", {times: 5}, 100);
                }
                else {
                    PF('mdpDialog').hide();
                    PF('growlError').renderMessage({summary: 'Succès!', detail: 'Votre mot de passe a été changé !', severity: 'info'});
                }
            }
            
             function handleModification(xhr, status, args) {
                if (args.validationFailed) {
                    PF('modifyDialog').jq.effect("shake", {times: 5}, 100);
                }
                else {
                    PF('modifyDialog').hide();
                    PF('growlError').renderMessage({summary: 'Succès!', detail: 'Vos informations ont été modifiées !', severity: 'info'});
                }
            }

    </script>
    
      
    <h:panelGroup id="informations">
       
        <p>
            <h:outputLabel for="login" class="labelModificationForm"> Login: </h:outputLabel>
            <h:outputText  id="login" value="#{contractorEditBean.contractor.login}"/>
        </p>    
        
        <p>
            <h:outputLabel for="firstName" class="labelModificationForm"> Prénom: </h:outputLabel>
            <h:outputText  id="firstName" value="#{contractorEditBean.contractor.representatorFirstname}"/>
        </p>
        
        <p>
            <h:outputLabel for="lastName" class="labelModificationForm"> Nom: </h:outputLabel>
            <h:outputText  id="lastName" value="#{contractorEditBean.contractor.representatorLastname}"/>
        </p>

        <p>
            <h:outputLabel for="email" class="labelModificationForm"> Email : </h:outputLabel>
            <h:outputText  id="email" value="#{contractorEditBean.contractor.email}"/>
        </p>

        <p>
            <h:outputLabel for="phoneNumber" class="labelModificationForm"> Phone : </h:outputLabel>
            <h:outputText  id="phoneNumber" value="#{contractorEditBean.contractor.phone}"/> 
        </p>
                      
        <h:form>
            
            <p:commandButton id="buttonModify" class="searchCommandButton" value="Modifier" onclick="PF('modifyDialog').show();">
                <p:ajax update="tabViewContractor:formModify:modifiedLogin"/>
                <p:ajax update="tabViewContractor:formModify:modifiedFirstName"/>
                <p:ajax update="tabViewContractor:formModify:modifiedLastName"/>
                <p:ajax update="tabViewContractor:formModify:modifiedEmail"/>
                <p:ajax update="tabViewContractor:formModify:modifiedPhoneNumber"/>
                <p:ajax update="tabViewContractor:formModify:modifiedEmail"/>
                <p:ajax update="tabViewContractor:formModify:loginMessage"/>
                <p:ajax update="tabViewContractor:formModify:phoneMessage"/>
                <p:ajax update="tabViewContractor:formModify:emailMessage"/>
                <p:ajax update="tabViewContractor:formModify:lastNameMessage"/>
                <p:ajax update="tabViewContractor:formModify:firstNameMessage"/>
            </p:commandButton>
            
            <p:commandButton class="searchCommandButton" id="buttonModifyMdp" value="Modifier Mot de passe" onclick="PF('mdpDialog').show();">
                <p:ajax update="tabViewContractor:formModifyMdp:confirmationPassword" resetValues="true"/>
                <p:ajax update="tabViewContractor:formModifyMdp:password" resetValues="true"/>
            </p:commandButton> 
        
        </h:form>
    
    </h:panelGroup>
                  
  
    <o:form id="formModify">
        
        <p:growl widgetVar="growlError" sticky="false" showDetail="true" life="3000" />
           
            <p:dialog header="Modification informations personelles :" modal="true" widgetVar="modifyDialog" resizable="false">             
             
                
                <h:panelGroup id="infoc">
                
                    <p>       
                        <h:outputLabel for="modifiedLogin" class="labelModificationForm"> Login: </h:outputLabel>
                        <p:inputText   id="modifiedLogin" value="#{contractorEditBean.contractor.login}">
                            <f:ajax  event="blur" render="loginMessage"/>
                            <f:validator validatorId="com.gdf.loginAlreadyExistForModificationValidator"/>
                            <f:attribute value="#{contractorEditBean.contractor.id}" name="idContractor"/>
                        </p:inputText>
                        <h:message id="loginMessage" for="modifiedLogin" errorClass="erreur" />
                    </p>

                    <p>
                        <h:outputLabel for="modifiedFirstName" class="labelModificationForm"> Prénom: </h:outputLabel>
                        <p:inputText  id="modifiedFirstName" value="#{contractorEditBean.contractor.representatorFirstname}">
                            <f:ajax  event="blur" render="firstNameMessage"/>
                        </p:inputText>
                        <h:message id="firstNameMessage" for="modifiedFirstName" errorClass="erreur"  />
                    </p>

                    <p>
                        <h:outputLabel for="modifiedLastName" class="labelModificationForm"> Nom: </h:outputLabel>
                        <p:inputText  id="modifiedLastName" value="#{contractorEditBean.contractor.representatorLastname}">
                            <f:ajax  event="blur" render="lastNameMessage"/>
                        </p:inputText>
                        <h:message id="lastNameMessage" for="modifiedLastName" errorClass="erreur" />
                    </p>

                    <p>
                        <h:outputLabel for="modifiedEmail" class="labelModificationForm"> Email : </h:outputLabel>
                        <p:inputText  id="modifiedEmail" value="#{contractorEditBean.contractor.email}">
                            <f:ajax  event="blur" render="emailMessage"/>
                            <f:validator validatorId="com.gdf.mailFormatValidator"/>
                        </p:inputText>    
                        <h:message id="emailMessage" for="modifiedEmail" errorClass="erreur" />
                    </p>

                    <p>
                        <h:outputLabel for="modifiedPhoneNumber" class="labelModificationForm"> Phone : </h:outputLabel>
                        <p:inputText  id="modifiedPhoneNumber" value="#{contractorEditBean.contractor.phone}">
                            <f:validator validatorId="com.gdf.phoneFormatValidator"/>
                            <f:ajax  event="blur" render="phoneMessage"/>
                        </p:inputText>
                        <h:message id="phoneMessage" for="modifiedPhoneNumber" errorClass="erreur" /> 
                    </p>

                    <p:commandButton value="Modifier" update="tabViewContractor:informations" actionListener="#{contractorEditBean.update()}" 
                                                         oncomplete="handleModification(xhr, status, args)" />
                </h:panelGroup>
              
                
            <h:form>
                <p:commandButton class="searchCommandButton"  value="Annuler" actionListener="#{contractorEditBean.undo()}" oncomplete="PF('modifyDialog').hide();"></p:commandButton>  
            </h:form> 
       
         </p:dialog>
    </o:form>
    
    
        <!-- Dialogue password -->
       
    <o:form id="formModifyMdp">
        
        <p:growl widgetVar="growlError" sticky="false" showDetail="true" life="3000" />
            
            <p:dialog header="Modification du Mot de passe:" modal="true" widgetVar="mdpDialog" resizable="false">   
                <p>
                    <h:outputLabel value ="" for="password" class="labelModificationForm" >Mot de passe</h:outputLabel>
                    <h:inputSecret id="password" value="#{contractorEditBean.contractor.password}" size="20" maxlength="20" binding="#{composantMotDePasse}" >
                        <f:ajax event="blur" execute="password confirmationPassword" render="passwordMessage confirmationPasswordMessage" />
                    </h:inputSecret>  
                    <h:message id="passwordMessage" for="password" errorClass="erreur" />
                </p>

                <p>
                    <h:outputLabel for="confirmationPassword" class="labelModificationForm">Confirmation du mot de passe</h:outputLabel>
                    <h:inputSecret id="confirmationPassword" value="#{contractorEditBean.contractor.password}" size="20" maxlength="20">
                        <f:validator validatorId="passwordConfirmationValidator" />
                        <f:attribute name="composantMotDePasse" value="#{composantMotDePasse}" />
                        <f:ajax event="blur" execute="password confirmationPassword" render="passwordMessage confirmationPasswordMessage" /> 
                    </h:inputSecret> 
                    <h:message id="confirmationPasswordMessage" for="confirmationPassword" errorClass="erreur" />
                </p>

                <p:commandButton value="Modifier"  actionListener="#{contractorEditBean.update()}" 
                                                 oncomplete="handleMdpModification(xhr, status, args)" />
                <p:commandButton value="Annuler" oncomplete="PF('mdpDialog').hide();" />

            </p:dialog>      
    </o:form>

</ui:composition>
 